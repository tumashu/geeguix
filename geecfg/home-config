;;; -*- mode: scheme; -*-

;; This "home-environment" file can be passed to 'guix home reconfigure'
;; to reproduce the content of your profile.  This is "symbolic": it only
;; specifies package names.  To reproduce the exact same profile, you also
;; need to capture the channels being used, as returned by "guix describe".
;; See the "Replicating Guix" section in the manual.

(use-modules
 (gnu home)
 (gnu packages)
 (gnu services)
 (guix gexp)
 (gnu home services)
 (gnu home services shells)
 (srfi srfi-13))

(home-environment
 (packages
  (map (compose list specification->package+output)
       (list "adwaita-icon-theme"
             "bash-completion"
             "brightnessctl"
             "elementary-xfce-icon-theme"
             "engrampa"
             "emacs"
             "fcitx5"
             "fcitx5-chinese-addons"
             "fcitx5-configtool"
             ;; "firefox"
             "font-wqy-microhei"
             "gimp"
             "git"
             "gnome-icon-theme"
             "gparted"
             "gtk-xfce-engine"
             "icecat"
             "libreoffice"
             "mercurial"
             "mousepad"
             "mpv"
             "p7zip"
             "ristretto"
             "tango-icon-theme"
             ;; "ungoogled-chromium"
             "unrar"
             "unzip"
             "vlc"
             "watchexec"
             "xfce4-screenshooter"
             "zile")))
 (services
  (list (service
         home-bash-service-type
         (home-bash-configuration
          (guix-defaults? #t)
          (aliases
           `(("la" . "ls -A")
             ("l"  . "ls -CF")
             ("iguix"            .
              "${GUIX_CHECKOUT}/pre-inst-env guix")
             ("iguix-pull"       .
              ,(string-join
                '("guix pull --allow-downgrades")))
             ("iguix-make"       .
              ,(string-join
                '("cd ${GUIX_CHECKOUT};"
                  "${GUIX_CHECKOUT}/pre-inst-env guix shell -D guix -- make")))
             ("ichannel-link"    .
              ,(string-join
                '("rm -f $HOME/.config/guix/channels.scm;"
                  "ln -s $HOME/guix/geeguix/geecfg/channel"
                  "$HOME/.config/guix/channels.scm")))
             ("isystem-reconfig" .
              ,(string-join
                '("sudo -E guix system reconfigure --allow-downgrades"
                  "$HOME/guix/geeguix/geecfg/system-config")))
             ("ihome-reconfig"   .
              ,(string-join
                '("guix home reconfigure"
                  "$HOME/guix/geeguix/geecfg/home-config")))))
          (environment-variables
           `(;; Fcitx5 input method
             ("GTK_IM_MODULE" . "fcitx")
	     ("QT_IM_MODULE"  . "fcitx")
	     ("XMODIFIERS"    . "@im=fcitx")

	     ("GUIX_GTK2_IM_MODULE_FILE" .
              "${GUIX_PROFILE}/lib/gtk-2.0/2.10.0/immodules-gtk2.cache")
	     ("GUIX_GTK3_IM_MODULE_FILE" .
              "${GUIX_PROFILE}/lib/gtk-3.0/3.0.0/immodules-gtk3.cache")

             ;; Environment variables use by guix system.
             ("GUIX_CHECKOUT"     . "${HOME}/guix/guix")
             ("GUIX_PACKAGE_PATH" .
              ,(string-join
                '("${HOME}/guix/geeguix"
                  "${HOME}/guix/nonguix"
                  "${GUIX_PACKAGE_PATH}") ":")))))))))

;;; -*- mode: scheme; -*-

;; This "home-environment" file can be passed to 'guix home reconfigure'
;; to reproduce the content of your profile.  This is "symbolic": it only
;; specifies package names.  To reproduce the exact same profile, you also
;; need to capture the channels being used, as returned by "guix describe".
;; See the "Replicating Guix" section in the manual.

(use-modules
 (gnu home)
 (gnu packages)
 (gnu services)
 (guix gexp)
 (gnu home services)
 (gnu home services shells)
 (srfi srfi-13))

(home-environment
 (packages
  (map (compose list specification->package+output)
       (list "bash"
             "bash-completion"
             "p7zip"
             "unrar"
             "zip"
             ;; 要想 caja 支持 extensions, 就必须在个人目录中将 caja 和
             ;; caja-extensions 两个包再装一次，不然文件
             ;; ~/.guix-profile/etc/profile 中不会 *自动* 生成环境变量
             ;; CAJA_EXTENSION_DIRS 对应的设置，如果不想这么折腾，也可以自己设
             ;; 置 CAJA_EXTENSION_DIRS 的值。
             "mate"
             "caja"
             "caja-extensions"
             "ungoogled-chromium"
             "gimp"
             "cheese"
             ;; "firefox"
             "unzip"
             "font-wqy-microhei"
             "fcitx5-chinese-addons"
             "fcitx5-configtool"
             "fcitx5"
             "zile"
             "gparted"
             "file-roller"
             "icecat"
             "libreoffice"
             "mercurial"
             "git"
             "emacs")))
 (services
  (list (service
         home-bash-service-type
         (home-bash-configuration
          (guix-defaults? #t)
          (aliases
           `(("la" . "ls -A")
             ("l"  . "ls -CF")
             ("iguix-pull"       .
              "${GUIX_CHECKOUT}/pre-inst-env guix pull --allow-downgrades")
             ("ichannel-link"    .
              ,(string-append "rm -f $HOME/.config/guix/channels.scm; "
                              "ln -s $HOME/guix/geeguix/geecfg/channel "
                              "$HOME/.config/guix/channels.scm"))
             ("isystem-reconfig" .
              ,(string-append "sudo -E ${GUIX_CHECKOUT}/pre-inst-env "
                              "guix system reconfigure --allow-downgrades "
                              "$HOME/guix/geeguix/geecfg/system-config"))
             ("ihome-reconfig"   .
              ,(string-append "${GUIX_CHECKOUT}/pre-inst-env guix home reconfigure "
                              "$HOME/guix/geeguix/geecfg/home-config"))))
          (environment-variables
           `(;; Fcitx5 input method
             ("GTK_IM_MODULE" . "fcitx")
	     ("QT_IM_MODULE"  . "fcitx")
	     ("XMODIFIERS"    . "@im=fcitx")

             ;; use "/run/current-system/profile/" if install fcitx in system.
	     ("GUIX_GTK2_IM_MODULE_FILE" . "${GUIX_PROFILE}/lib/gtk-2.0/2.10.0/immodules-gtk2.cache")
	     ("GUIX_GTK3_IM_MODULE_FILE" . "${GUIX_PROFILE}/lib/gtk-3.0/3.0.0/immodules-gtk3.cache")

             ;; Environment variables use by guix system.
             ("GUIX_CHECKOUT"            . "${HOME}/guix/guix")
             ("GUIX_PACKAGE_PATH"        .
              ,(string-append "${HOME}/guix/geeguix:"
                              "${HOME}/guix/nonguix:"
                              "${GUIX_PACKAGE_PATH}")))))))))
